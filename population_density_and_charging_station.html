<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>人口密度与充电桩规划</title>
</head>

<body>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="main" style="height:1200px;width:1600px"></div>
	<!-- ECharts单文件引入 -->
    <script src="echarts-master/build/dist/echarts.js"></script>
	<!--<script src="http://libs.baidu.com/jquery/1.9.0/jquery.min.js" type="text/javascript"></script>-->
	<script type="text/javascript" src="libs/jquery-1.11.3.min.js"></script> 
	<script type="text/javascript" src="libs/jquery.subscribe.js"></script>

	<script type="text/javascript">
		//console.log(population_density_data);
		function show_map(){	
				// 路径配置
				require.config({
					paths: {
						echarts: 'echarts-master/build/dist'
					}
				});
				
				//alert(2);
		
						
				console.log("show map begin");
				// 使用
				require(
					[
						'echarts',
						'echarts/chart/map' // 使用地图，按需加载
						//'ecahrts/chart/markPoint'
					],
					function (ec) {
						// 基于准备好的dom，初始化echarts图表
						var myChart = ec.init(document.getElementById('main')); 
						option = {
							title : {
								text: '人口密度与充电站规划',
								x:'center',
								textStyle: {
									fontSize: '20',
								}
							},
							tooltip : {
								trigger: 'item'
							},
							/*
							legend: {
								orient: 'vertical',
								x:'left',
								data:['iphone3','iphone4','iphone5']
							},
							*/
							dataRange: {
								min: 0,
								max: 2500,
								x: 'left',
								y: 'bottom',
								text:['高','低'],           // 文本，默认为数值文本
								calculable : true
							},
							toolbox: {
								show: true,
								orient : 'vertical',
								x: 'right',
								y: 'center',
								feature : {
									mark : {show: true},
									dataView : {show: true, readOnly: false},
									restore : {show: true},
									saveAsImage : {show: true}
								}
							},
							roamController: {
								show: true,
								x: 'right',
								mapTypeControl: {
									'china': true
								}
							},
							series : [
								{
									name: 'charging station plan',
									type: 'map',
									mapType: 'china',
									roam: false,
									itemStyle:{
										normal:{label:{show:true}},
										emphasis:{label:{show:true}}
									},
									data:population_density_data,
									markPoint:{
										symbolSize: 10,
										itemStyle: {
											normal: {
												borderColor: '87cefa',
												borderWidth: 1,
												label: {
													show:false,
													
													formatter: function (params,ticket,callback) {//格式化展现（标签+值）
														return params.name + params.value;
													}  
												}
											},
											emphasis: {
												borderColor: '1e90ff',
												borderWidth: 5,
												label: {
													show: false,
													formatter: function (params,ticket,callback) {//格式化展现（标签+值）
														return params.name + params.value + "12345";
													}  
												}
											}
										},
										data: charging_stations_data,
										
									},
									geoCoord : charging_stations_geoCoord,
									
								}
							]	
							
						};
							
				  


						// 为echarts对象加载数据 
						myChart.setOption(option); 

						console.log("show map finished");
					}
				);
		}
		jQuery.subscribe("load_data_done", show_map);
    </script>
	<script type="text/javascript">
		console.log("123");
    	
		/*$(document).ready(function() {*/
		function load_data(){
				//setTimeout(function(){
						
						$.getJSON('json_data/population_density.json',function(json){
							population_density_data = json.data;
							charging_stations_data = json.charging_stations_info;
							charging_stations_geoCoord = json.charging_stations_geoCoord;
							console.log("load population_density_data finished");
							});
						/*
						$.getJSON('json_data/charging_stations.json',function(json){
							charging_stations_data = json.charging_stations_info;
							charging_stations_geoCoord = json.charging_stations_geoCoord;
							console.log("load charging_stations_data finished");
							});
						*/
							
				//}, 1000);
				
				//setTimeout(function(){
						console.log("load finished");
						jQuery.publish("load_data_done");
				//}, 000);
		//});    
		}
		//alert(1);
		load_data();
	</script>
</body>
