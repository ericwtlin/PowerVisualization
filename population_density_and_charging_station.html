<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>人口密度与充电桩规划</title>
</head>

<body>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="main" style="height:1100px;width:1100px"></div>
	<!-- ECharts单文件引入 -->
    <script src="echarts-master/build/dist/echarts.js"></script>
	<!--<script src="http://libs.baidu.com/jquery/1.9.0/jquery.min.js" type="text/javascript"></script>-->
	<script type="text/javascript" src="libs/jquery-1.11.3.min.js"></script> 
	<script type="text/javascript" src="libs/jquery.subscribe.js"></script>
	

	<script type="text/javascript">
		//把这个放在body前面，因为在加载地图前，必须先把数据加载完成;也可以采用其他方法来控制加载数据必须先执行完
		var population_density_data, charging_stations_data, charging_stations_geoCoord, heat_data_preprocess;
		$.getJSON('population_density_and_charging_station/data.json',function(json){
			population_density_data = json.data;
			charging_stations_data = json.charging_stations_info;
			charging_stations_geoCoord = json.charging_stations_geoCoord;
			heat_data= json.heat_data_preprocess;
			console.log("load json data finished");
			});
	</script>

	<script type="text/javascript">
    	//处理得到热力数据
		console.log("make heat data begin");
		//var heat_data = heat_data_preprocess;
		/*
		var heat_data = [];
		for(var i = 0; i < heat_data_preprocess.length; i ++){
			//for(var j = 0; j < 100; j ++){	//重复100遍，否则数量太少，显示不出效果
				heat_data.push([heat_data_preprocess[i].x, heat_data_preprocess[i].y, heat_data_preprocess[i].value]);
			//}
		}
		*/

		/*载入json数据结束后，通过百度地图API获取对应区域的坐标
		因为提供的人口数据里区域的粒度肯定不会太小，而且肯定是行政区域，所以从“XX省XX市XX县XX镇”这样准确的地址就不会有坐标错误了
		能够直接提供人口数据对应的坐标数据当然更好
		*/
		/*
		setTimeout(function(){
				var heatData = [];
				for(var i = 0; i < population_density_data.length; i ++){
					var poi = GetCoordinateByLocationName(population_density_data[i].name);
					heatData.push([
							poi.point.lng,	//logitude
							poi.point.lat,	//latitude
							population_density_data[i].value
						]);	
					}}, 1000);
		*/
		console.log("make heat data finished");

	</script>
	<script type="text/javascript">
		//console.log(population_density_data);
		//setTimeout(function show_map(){	
				// 路径配置
				require.config({
					paths: {
						echarts: 'echarts-master/build/dist'
					}
				});
				
				//alert(2);
		
						
				console.log("show map begin");
				require(
					[
						'echarts',
						'echarts/chart/map' // 使用地图，按需加载
						//'ecahrts/chart/markPoint'
					],
					function (ec) {
						// 基于准备好的dom，初始化echarts图表
						var myChart = ec.init(document.getElementById('main')); 

						option = {
							title : {
								text: '人口密度与充电站规划',
								x:'center',
								textStyle: {
									fontSize: '20',
								}
							},
							tooltip : {
								trigger: 'item',
								formatter: function (params,ticket,callback) {
									//console.log(params);
									
									if(params[5].type == null || params[5].type == undefined){	//说明是地区区块
										return params[5].name + "<br/>人口密度: " + params[5].value;
										
									}else{	//说明是markPoint
										return params[5].name + "<br/>类别: " + params[5].type + "<br/>功率: " + params[5].power + "<br/>电压: " + params[5].voltage;
									}
								}
							},
							/*
							legend: {
								orient: 'vertical',
								x:'left',
								data:['iphone3','iphone4','iphone5']
							},
							*/
							dataRange: {
								min: 0,
								max: 2500,
								x: 'left',
								y: 'bottom',
								text:['高','低'],           // 文本，默认为数值文本
								calculable : true
							},
							toolbox: {
								show: true,
								orient : 'vertical',
								x: 'right',
								y: 'center',
								feature : {
									mark : {show: true},
									dataView : {show: true, readOnly: false},
									restore : {show: true},
									saveAsImage : {show: true}
								}
							},
							roamController: {
								show: true,
								x: 'right',
								mapTypeControl: {
									'china': true
								}
							},
							series : [
								{
									name: 'charging station plan',
									type: 'map',
									mapType: '北京',
									roam: false,
									//selectedMode:  'multiple',
									itemStyle:{
										normal:{label:{show:true}},	//未mouseover的情况下是否显示label
										emphasis:{label:{show:true}} 	//mouseover的情况下是否显示label
									},
									data:population_density_data,
									markPoint:{
										symbolSize: 10,
										//large: true,
										itemStyle: {
											normal: {
												borderColor: '87cefa',
												borderWidth: 1,
												label: {
													show:false,
													
													formatter: function (params,ticket,callback) {//格式化展现（标签+值）
														return params.name + params.value;
														//return params.value + params.name;
													}  
												}
											},
											emphasis: {
												borderColor: '1e90ff',
												borderWidth: 5,
												label: {
													show: false,
													formatter: function (params,ticket,callback) {//格式化展现（标签+值）
														return params.name + params.value;
														//return params.value + params.name;
													}  
												}
											}
										},
										data: charging_stations_data,
										
									},
									geoCoord : charging_stations_geoCoord,
									heatmap: {
										blurSize: 30,
										gradientColors: ['blue', 'cyan', 'lime', 'yellow', 'red'],
										minAlpha: 0.1,
										valueScale: 1,
										opacity: 1,
										data: heat_data

									}
								}
							]	
							
						};
							
				  


						// 为echarts对象加载数据 
						myChart.setOption(option); 

						console.log("show map finished");
					}
				);
		
			//jQuery.subscribe("load_data_done", show_map);
		//}, 3000);
    </script>
	
</body>
</html>
